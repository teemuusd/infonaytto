<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infonäyttö Tampere: Nysse & Sää</title>
    <!-- Ladataan Tailwind CSS CDN:n kautta -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ladataan React, ReactDOM ja Babel JSX-tukea varten CDN:n kautta -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Asetetaan juuri elementti täyttämään koko näkymä */
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Custom animaatio palautteen vaihtumiseen */
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Palautteet on nyt upotettu suoraan koodiin virheiden välttämiseksi
        const FEEDBACK_DATA = [
          {"Palaute":"testimmm","nimimerkki":"testero"},
          {"Palaute":"mm","nimimerkki":"nnn"},
          {"Palaute":"hohoho","nimimerkki":"joulupukki"},
          {"Palaute":"testi","nimimerkki":"testaaja"},
          {"Palaute":"testi2","nimimerkki":"testaaja2"},
          {"Palaute":"ok","nimimerkki":"ok?"},
          {"Palaute":"test","nimimerkki":"juu"},
          {"Palaute":"123","nimimerkki":"321"},
          {"Palaute":"123","nimimerkki":"321"},
          {"Palaute":"testi2","nimimerkki":"testaaja2"},
          {"Palaute":"joko","nimimerkki":"nyt"},
          {"Palaute":"toimispa","nimimerkki":"jooko"}
        ];

        // Ikonien SVG-määritykset
        const ICONS = {
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 21.7c-4.9-5.1-8-10.2-8-14.7C4 3.7 7.7 0 12 0s8 3.7 8 7c0 4.5-3.1 9.6-8 14.7z"/><circle cx="12" cy="7" r="3"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>,
            Cloud: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19H12a5 5 0 0 1-4.72-3.85c-.09-.59-.12-1.2-.12-1.8a5 5 0 0 1 10-2z"/></svg>,
            CloudRain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 13V9a6 6 0 0 0-12 0v4"/><line x1="16" y1="17" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/><line x1="8" y1="17" x2="8" y2="21"/></svg>,
            CloudSnow: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 13V9a6 6 0 0 0-12 0v4"/><path d="M10 21v-3.5"/><path d="M14 21v-3.5"/><path d="M12 18v-3.5"/></svg>,
            Wind: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 7L5 12h5.5l-.5 5 4.5-5h-5.5l.5-5z"/><path d="M21 17h-7"/></svg>,
            Droplets: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M13.5 8.5l-.5.5 1 1.5-1 1.5 1 1.5-1 1.5 1 1.5M10.5 8.5l.5.5-1 1.5 1 1.5-1 1.5 1 1.5M7.5 8.5l-.5.5 1 1.5-1 1.5 1 1.5-1 1.5"/></svg>,
            ThumbsUp: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 14V10"/><path d="M10 20v-7h-3l-2-2v4h5.5l.5 2z"/><path d="M17 14l-2 2h-5.5V10h-2V7.5L8 5h9l4 4v5z"/></svg>,
            Eye: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
            Moon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
        };

        const getWeatherIcon = (code) => {
          const props = { className: "w-12 h-12" };
          if (code === 0 || code === 1) return <ICONS.Sun {...props} className={`${props.className} text-yellow-400`} />;
          if (code === 2 || code === 3) return <ICONS.Cloud {...props} className={`${props.className} text-gray-400`} />;
          if (code >= 51 && code <= 67) return <ICONS.CloudRain {...props} className={`${props.className} text-blue-400`} />;
          if (code >= 71 && code <= 77) return <ICONS.CloudSnow {...props} className={`${props.className} text-white`} />;
          if (code >= 95) return <ICONS.CloudRain {...props} className={`${props.className} text-purple-400`} />;
          return <ICONS.Cloud {...props} className={`${props.className} text-gray-400`} />;
        };

        const getWeatherDescription = (code) => {
          const codes = {
            0: 'Selkeää', 1: 'Melkein selkeää', 2: 'Puolipilvistä', 3: 'Pilvistä', 45: 'Sumua',
            48: 'Huurteista sumua', 51: 'Kevyttä tihkua', 53: 'Tihkusadetta', 55: 'Tiheää tihkua',
            61: 'Kevyttä sadetta', 63: 'Sadetta', 65: 'Voimakasta sadetta', 71: 'Kevyttä lumisadetta',
            73: 'Lumisadetta', 75: 'Voimakasta lumisadetta', 95: 'Ukkosta',
          };
          return codes[code] || 'Tuntematon';
        };

        function InfoDisplay() {
          const [time, setTime] = useState(new Date());
          const [weather, setWeather] = useState(null);
          const [loadingWeather, setLoadingWeather] = useState(true);
          const [filterMode, setFilterMode] = useState('normal');
          const [currentFeedbackIndex, setCurrentFeedbackIndex] = useState(0);
          
          // Palautteet staattisessa vakiossa

          // Gemini State ja API-kutsut poistettu

          // Päivitä kello sekunnin välein
          useEffect(() => {
            const timer = setInterval(() => setTime(new Date()), 1000);
            return () => clearInterval(timer);
          }, []);

          // Vaihda palautetta 20 sekunnin välein (käyttää staattista dataa)
          useEffect(() => {
            if (FEEDBACK_DATA.length > 0) {
                const feedbackTimer = setInterval(() => {
                  setCurrentFeedbackIndex((prev) => (prev + 1) % FEEDBACK_DATA.length);
                }, 20000);
                return () => clearInterval(feedbackTimer);
            }
          }, []);


          // Hae sää (Tampereen koordinaatit)
          useEffect(() => {
            const fetchWeather = async () => {
              try {
                const response = await fetch(
                  'https://api.open-meteo.com/v1/forecast?latitude=61.498&longitude=23.761&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m,relative_humidity_2m&wind_speed_unit=ms&timezone=auto'
                );
                const data = await response.json();
                
                if (data.current) {
                    setWeather(data.current);
                    setLoadingWeather(false);
                } else {
                    setLoadingWeather(false);
                }
              } catch (error) {
                console.error("Virhe sään haussa:", error);
                setLoadingWeather(false);
              }
            };

            fetchWeather();
            // Päivitä sää 10 minuutin välein
            const weatherTimer = setInterval(fetchWeather, 10 * 60 * 1000);
            return () => clearInterval(weatherTimer);
          }, []); // Gemini-dependency poistettu

          const formatDate = (date) => {
            return date.toLocaleDateString('fi-FI', { weekday: 'long', day: 'numeric', month: 'long' });
          };

          const formatTime = (date) => {
            return date.toLocaleTimeString('fi-FI', { hour: '2-digit', minute: '2-digit' });
          };

          // Määritellään suodattimet eri tiloille
          const getFilterStyle = () => {
            switch (filterMode) {
              case 'grayscale':
                return 'grayscale(100%) contrast(110%) brightness(90%)';
              // Invert-tila poistettu käytöstä käyttöliittymästä, mutta logiikka voi jäädä varalle
              default:
                return 'none';
            }
          };

          const currentFeedback = FEEDBACK_DATA.length > 0 ? FEEDBACK_DATA[currentFeedbackIndex] : {Palaute: "Palautteita ei saatavilla.", nimimerkki: "Info"};

          return (
            <div className="min-h-screen bg-slate-900 text-slate-100 p-4 font-sans overflow-hidden flex flex-col gap-4">
              
              {/* Yläpalkki: Kello ja Päivämäärä */}
              <header className="flex justify-between items-center bg-slate-800/50 p-6 rounded-2xl border border-slate-700 shadow-lg backdrop-blur-sm">
                <div className="flex items-center gap-4">
                  <ICONS.Calendar className="w-8 h-8 text-blue-400" />
                  <span className="text-3xl font-light capitalize">{formatDate(time)}</span>
                </div>
                <div className="flex items-center gap-4">
                  <ICONS.Clock className="w-8 h-8 text-blue-400" />
                  <span className="text-6xl font-bold tracking-wider">{formatTime(time)}</span>
                </div>
              </header>

              {/* Pääsisältö: Grid-asettelu */}
              <main className="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 h-full">
                
                {/* Vasen palsta: Sää ja Palaute */}
                <div className="lg:col-span-1 flex flex-col gap-4">
                  
                  {/* Sääkortti - SININEN TEEMA */}
                  <div className="bg-gradient-to-br from-blue-900/40 to-slate-900 rounded-2xl p-8 border border-blue-500/20 shadow-xl flex-1 flex flex-col justify-between relative overflow-hidden">
                    
                    <div className="relative z-10">
                      <div className="flex items-center gap-2 text-blue-400 mb-6">
                        <ICONS.MapPin className="w-5 h-5" />
                        <h2 className="text-xl font-semibold uppercase tracking-widest">Sää Tampere</h2>
                      </div>

                      {loadingWeather ? (
                        <div className="animate-pulse flex flex-col gap-4">
                          <div className="h-12 w-12 bg-slate-700 rounded-full"></div>
                          <div className="h-8 w-32 bg-slate-700 rounded"></div>
                        </div>
                      ) : weather ? (
                        <div className="space-y-8">
                          <div className="flex items-center gap-6">
                            {getWeatherIcon(weather.weather_code)}
                            <div>
                              <div className="text-6xl font-bold">{Math.round(weather.temperature_2m)}°C</div>
                              <div className="text-xl text-slate-400">{getWeatherDescription(weather.weather_code)}</div>
                            </div>
                          </div>

                          <div className="grid grid-cols-2 gap-4 mt-8">
                            <div className="bg-slate-900/50 p-4 rounded-xl border border-blue-500/10">
                              <div className="flex items-center gap-2 text-slate-400 mb-1">
                                <ICONS.Wind className="w-4 h-4" />
                                <span className="text-sm">Tuuli</span>
                              </div>
                              <span className="text-2xl font-semibold">{weather.wind_speed_10m} <span className="text-sm font-normal">m/s</span></span>
                            </div>
                            
                            <div className="bg-slate-900/50 p-4 rounded-xl border border-blue-500/10">
                              <div className="flex items-center gap-2 text-slate-400 mb-1">
                                <ICONS.Droplets className="w-4 h-4" />
                                <span className="text-sm">Tuntuu kuin</span>
                              </div>
                              <span className="text-2xl font-semibold">{Math.round(weather.apparent_temperature)}°</span>
                            </div>
                          </div>
                        </div>
                      ) : (
                        <p>Säätietoja ei saatavilla.</p>
                      )}
                    </div>
                    
                    {/* Gemini-vinkki poistettu tästä kohtaa */}
                    
                     <div className="mt-4 text-xs text-slate-500 text-center relative z-10">
                        Säätiedot päivittyvät automaattisesti 10 minuutin välein
                      </div>
                  </div>

                  {/* Palautekortti (Täyttää "tyhjän tilan") */}
                  <div className="bg-gradient-to-br from-blue-900/40 to-slate-900 rounded-2xl p-8 border border-blue-500/20 shadow-xl flex flex-col justify-center min-h-[250px] relative overflow-hidden group transition-all duration-500 hover:border-blue-500/40">
                    {/* Koristeellinen taustaikoni */}
                    <ICONS.ThumbsUp className="absolute -right-4 -bottom-4 w-32 h-32 text-blue-500/5 rotate-12" />
                    
                    <div key={currentFeedbackIndex} className="relative z-10 animate-fade-in">
                      <div className="flex items-center gap-2 text-blue-400 mb-4">
                        <ICONS.ThumbsUp className="w-6 h-6" />
                        <h2 className="text-sm font-bold uppercase tracking-widest">Positiiviset palautteet</h2>
                      </div>
                      
                      <blockquote className="text-2xl font-light italic leading-relaxed text-slate-100 mb-6">
                        "{currentFeedback.Palaute}"
                      </blockquote>
                      
                      <div className="flex items-center gap-3">
                        <div className="w-8 h-8 rounded-full bg-blue-600/30 flex items-center justify-center text-blue-400 font-bold text-sm">
                          {currentFeedback.nimimerkki.charAt(0).toUpperCase()}
                        </div>
                        <cite className="text-slate-400 not-italic font-medium">
                          {currentFeedback.nimimerkki}
                        </cite>
                      </div>
                    </div>

                    {/* Indikaattorit alhaalla */}
                    <div className="absolute bottom-4 right-4 flex gap-1">
                      {FEEDBACK_DATA.map((_, idx) => (
                        <div 
                          key={idx}
                          className={`h-1 rounded-full transition-all duration-300 ${idx === currentFeedbackIndex ? 'w-4 bg-blue-500' : 'w-1 bg-slate-700'}`}
                        />
                      ))}
                    </div>
                  </div>

                </div>

                {/* Oikea palsta: Nysse Monitori */}
                <div className="lg:col-span-2 relative bg-black rounded-2xl overflow-hidden border border-slate-700 shadow-xl group">
                  {/* Kontrollit - Sijoitettu oikeaan yläkulmaan. Yksinkertaistettu pelkkiin symboleihin. Tausta ei ole läpinäkyvä. */}
                  <div className="absolute top-6 right-6 z-20 pointer-events-auto">
                    <div className="flex gap-2 p-2 bg-slate-900 rounded-lg border border-slate-700 shadow-2xl items-center">
                        
                        <button onClick={() => setFilterMode('normal')} className={`p-2 rounded-md transition-colors ${filterMode === 'normal' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-700'}`} title="Normaali"><ICONS.Eye size={20} /></button>
                        <button onClick={() => setFilterMode('grayscale')} className={`p-2 rounded-md transition-colors ${filterMode === 'grayscale' ? 'bg-slate-600 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-700'}`} title="Mustavalko"><ICONS.Moon size={20} /></button>

                    </div>
                  </div>

                  <div className="w-full h-full bg-white" style={{ filter: getFilterStyle(), transition: 'filter 0.5s ease' }}>
                    <iframe
                      src="https://tremonitori.digitransit.fi/view?cont=4tGX7itc9tr9vVt4KuSTow=="
                      className="w-full h-full border-0 min-h-[500px]"
                      title="Tampere Monitori"
                      allowFullScreen
                    />
                  </div>
                </div>

              </main>
            </div>
          );
        }

        // Käynnistetään React-sovellus
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<InfoDisplay />);
    </script>
</body>
</html>
